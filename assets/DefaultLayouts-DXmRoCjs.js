const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ImageMaterial.glsl-B8OdYn9G.js","assets/index-cGsjYgnw.js","assets/index-1Ols0T8J.css","assets/elevationInfoUtils-BcQwXBrU.js","assets/RouteLayerInteraction-CFpOGYMb.js","assets/GraphicsLayer-DBoem6EB.js","assets/Stop-Dgn_Rgn3.js","assets/hitTestSelectUtils-Dmu0Kboe.js","assets/quantityUtils-BCodB9PY.js","assets/projectVectorToVector-CfMPrWog.js","assets/projectPointToVector-ChbrHkLb.js","assets/geodesicUtils-CgWJakNo.js","assets/plane-HiwvP9tU.js","assets/vectorStacks-CGdefod2.js","assets/mat3f64-B5o_lm6j.js","assets/mat4f64-q_b6UJoq.js","assets/quatf64-aQ5IuZRd.js","assets/sphere-Fi8gi249.js","assets/spatialReferenceEllipsoidUtils-Caqgk3vX.js","assets/geodeticLengthOperator-8Cd3lYwq.js","assets/geodeticCurveType-CirnHLSB.js","assets/earcut-D9gy186-.js","assets/triangle-DgYNOX0u.js","assets/lineSegment-CdImpY8L.js","assets/SketchTooltipInfo-h7pbQs5M.js","assets/MeshTransform-CK97zHAY.js","assets/quat-B1T8GAy7.js","assets/axisAngleDegrees-DB_HlJQY.js","assets/meshVertexSpaceUtils-CNmYJZrD.js","assets/MeshLocalVertexSpace-CwNqa7Fs.js","assets/memoize-DmxaQ-k8.js","assets/unitFormatUtils-C8fd1EbN.js","assets/ByteSizeUnit-BsxeN7wM.js","assets/frustum-8atK0_DA.js","assets/RibbonLine.glsl-CsJTSQ4C.js","assets/orientedBoundingBox-B5-jGkVl.js","assets/computeTranslationToOriginAndRotation-BpriSjts.js","assets/OutputColorHighlightOID.glsl-pO7ykQqY.js","assets/videoUtils-DQPF3O63.js","assets/requestImageUtils-w7asJ1zo.js","assets/basicInterfaces-CZwQPxTp.js","assets/TextureFormat-1mYWTFa-.js","assets/BufferView-UaDNtq90.js","assets/Indices-opzc5tkG.js","assets/VertexAttribute-B3BTnNfN.js","assets/glsl-Cj7KC756.js","assets/BindType-BBwFZqyN.js","assets/ShaderOutput-Bdd80V3g.js","assets/renderState-BEh_Q5tn.js","assets/boundedPlane-B-r3v9r8.js","assets/IntersectorType-gQim6TH1.js","assets/Octree-BvSBVBQF.js","assets/InterleavedLayout-Dt7Xk85W.js","assets/types-BKo2foNY.js","assets/dehydratedFeatureUtils-Cy6Rpke8.js","assets/hydratedFeatures-BZUOXjjw.js","assets/vec3f32-WCVSSNPR.js","assets/ShaderBuilder-Cba1LVoe.js","assets/glUtil-B_-DwONu.js","assets/VertexElementDescriptor-BLyltQyJ.js","assets/ProgramTemplate-ClOphZSE.js","assets/HUDMaterial-DmZ5LY8c.js","assets/SnappingContext-CRjD6Fhm.js","assets/PointSnappingHint-DM0SVsrw.js","assets/editPlaneUtils-BEjni9Kx.js","assets/distanceOperator-BflcA_5d.js","assets/Point2D-D2kgyQ2l.js","assets/ProjectionTransformation-C5NGE5t7.js","assets/Envelope2D-DpFkwyFI.js","assets/Transformation2D-DUMRLKSD.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/apiConverter-H2RF_StK.js","assets/jsonConverter-CZ37VDxk.js","assets/simplifyOperator-LgYsxUKR.js","assets/operatorSimplify-DVq73TY-.js","assets/ReactiveSet-d7-lddS4.js","assets/SelectedVertexTooltipInfo-3jboi92n.js","assets/TranslateTooltipInfo-Y_chsxUM.js","assets/ExtentScaleTooltipInfo-DjM9QFJ_.js","assets/GraphicManipulator-CW4RDSmH.js","assets/drapedUtils-CngZ7xAc.js"])))=>i.map(i=>d[i]);
import{on as es,ku as Pr,ik as Ir,kt as ts,uQ as rs,jW as H,h2 as y,uR as ss,cF as Xe,uS as Ut,pX as is,jd as Pe,ar as c,bJ as Ae,as as b,at as B,aO as Fe,bP as ct,aP as Ee,du as Ar,fF as as,hX as Ke,o8 as Wt,fU as ns,be as os,fH as ls,bo as q,fE as hs,i8 as cs,aR as Ie,eh as us,_ as re,uT as ds,f3 as Z,a3 as pe,dG as bt,hK as Dt,dS as Fr,dY as gs,dV as Er,dX as Pt,jy as ps,jH as J,jn as zt,jk as _s,am as fs,cK as ms,kq as It,a4 as vs,jt as Ve,b7 as qt,au as ys,o7 as jt,id as xs,h$ as bs,fW as Mr,i0 as wt,aU as ws,fY as Lr,uU as Cs,o9 as Ts,f$ as Os,nC as k,nD as _e,n6 as Te,jb as Gt,h1 as fe,n3 as S,uV as Rs,nB as Bt,oh as $s,e7 as Ss,f0 as Ds,dD as Ps,e6 as kt,dz as Is,uW as As,kz as Ue,uX as ut,mW as Fs,uY as Yt,uZ as Es,i4 as Ms,i9 as Ls,h_ as Ns,oi as Hs,fd as Vs,ii as Qt}from"./index-cGsjYgnw.js";import{p as Us,Y as Ws,n as zs,a5 as U,O as Nr,q as Se,i as At,a6 as qs,a7 as js,a2 as Xt,a8 as Kt,a9 as Zt,aa as Ft,h as Je,ab as Gs,ac as Me,K as De,ad as at,ae as Hr,g as Vr,af as Ur,v as se,x as ie,ag as Bs,ah as ks,ai as dt,aj as Ys,E,u as Et,ak as nt,al as gt,am as Qs,an as Xs,C as A,ao as Ks,ap as Zs,G as pt,D as Js,aq as Jt,_ as ei,ar as ti,as as ri,c as si,e as ii,at as ai,au as ni,a as oi,f as li,b as hi,av as ci,aw as ui,ax as di,ay as gi,az as pi,aA as _i,aB as fi,aC as mi,F as vi,z as yi,A as xi,B as bi,aD as wi,k as Ci,aE as Ti,aF as Oi,aG as Ri}from"./OutputColorHighlightOID.glsl-pO7ykQqY.js";import{U as $i}from"./Indices-opzc5tkG.js";import{t as W}from"./orientedBoundingBox-B5-jGkVl.js";import{e as p}from"./VertexAttribute-B3BTnNfN.js";import{r as Q,e as N}from"./mat4f64-q_b6UJoq.js";import{C as Si,E as Di,U as Pi}from"./sphere-Fi8gi249.js";import{m as Ii}from"./plane-HiwvP9tU.js";import{O as ae}from"./InterleavedLayout-Dt7Xk85W.js";import{n as R,u as Wr,d as _t,S as er,e as Ai}from"./ShaderOutput-Bdd80V3g.js";import{a as K,e as Mt}from"./basicInterfaces-CZwQPxTp.js";import{n as w}from"./glsl-Cj7KC756.js";import{i as ne}from"./ShaderBuilder-Cba1LVoe.js";import{B as ee,g as te,c as zr,f as Fi}from"./renderState-BEh_Q5tn.js";import{p as et,a as qr}from"./triangulationUtils-BHX6v0fG.js";import{t as Ei,l as Mi,a as Li,e as We,C as Ni,b as tr,u as Hi}from"./RibbonLine.glsl-CsJTSQ4C.js";import{a as Lt}from"./BindType-BBwFZqyN.js";import{j as Vi,v as rr,w as sr}from"./axisAngleDegrees-DB_HlJQY.js";import{t as ye}from"./VertexElementDescriptor-BLyltQyJ.js";import{a as Ui,o as ir}from"./ProgramTemplate-ClOphZSE.js";import{t as Wi}from"./NestedMap-C3hRTnZR.js";import{s as me,u as zi,c as oe,e as ze}from"./BufferView-UaDNtq90.js";import{e as qi}from"./dehydratedFeatureUtils-Cy6Rpke8.js";import{e as ji}from"./mat3f64-B5o_lm6j.js";function Nn(t,e,r=null){const s=[],a=e.mapPositions;Gi(e,s);const i=s[0][1].data,n=s[0][1].indices.length,o=$i(n);return Bi(e,s,o),Qi(e,s,o),ki(e,s,o),Yi(e,s,o),Xi(e,s,o),Ki(e,s),Zi(e,s,o),Ji(e,s,i),new Us(t,s,a,Ws.Line,r)}function Gi(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:s}=t,a=ea(r)&&s,i=r.length/3-(a?1:0),n=new Array(2*(i-1)),o=a?r.slice(0,-3):r;let l=0;for(let u=0;u<i-1;u++)n[l++]=u,n[l++]=u+1;e.push([p.POSITION,new W(o,n,3,a)])}function Bi(t,e,r){if(t.attributeData.colorFeature!=null)return;const s=t.attributeData.color;e.push([p.COLOR,new W(s??es,r,4)])}function ki(t,e,r){t.attributeData.normal&&e.push([p.NORMAL,new W(t.attributeData.normal,r,3)])}function Yi(t,e,r){t.attributeData.colorFeature!=null&&e.push([p.COLORFEATUREATTRIBUTE,new W([t.attributeData.colorFeature],r,1,!0)])}function Qi(t,e,r){t.attributeData.sizeFeature==null&&e.push([p.SIZE,new W([t.attributeData.size??1],r,1,!0)])}function Xi(t,e,r){t.attributeData.sizeFeature!=null&&e.push([p.SIZEFEATUREATTRIBUTE,new W([t.attributeData.sizeFeature],r,1,!0)])}function Ki(t,e){const{attributeData:{position:r,timeStamps:s}}=t;if(!s)return;const a=r.length/3,i=new Array(2*(a-1));let n=0;for(let o=0;o<a-1;o++)i[n++]=o,i[n++]=o+1;e.push([p.TIMESTAMPS,new W(s,i,3)])}function Zi(t,e,r){t.attributeData.opacityFeature!=null&&e.push([p.OPACITYFEATUREATTRIBUTE,new W([t.attributeData.opacityFeature],r,1,!0)])}function Ji(t,e,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Pr.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=Ir(r.length),a=ts(t.overlayInfo.spatialReference);for(let m=0;m<s.length;m+=3)rs(r,m,s,m,a);const i=r.length/3,n=zs(i+1);let o=ta,l=ra,u=0,d=0;H(o,s[d++],s[d++]),d++,n[0]=0;for(let m=1;m<i+1;++m)m===i&&(d=0),H(l,s[d++],s[d++]),d++,u+=ss(o,l),n[m]=u,[o,l]=[l,o];e.push([p.DISTANCETOSTART,new W(n,e[0][1].indices,1,!0)])}function ea(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const ta=y(),ra=y();var ar,nr;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(ar||(ar={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(nr||(nr={}));let sa=class extends Ui{};var G,or,lr;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(G||(G={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(or||(or={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(lr||(lr={}));let hr=class{constructor(){this._extent=Xe(),this.resolution=0,this.renderLocalOrigin=Ei(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new ia}get extent(){return this._extent}setupGeometryViews(e){if(this._setupGeometryView(),!e)return;const r=.001*e.range;if(this._extent[0]-r<=e.min){const s=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Ut(this._extent,e.range,0,s)}if(this._extent[2]+r>=e.max){const s=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Ut(this._extent,-e.range,0,s)}}_setupGeometryView(){this.canvasGeometries.numViews=1,is(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}},ia=class{constructor(){this.extents=[Xe(),Xe(),Xe()],this.numViews=0}};var x;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(x||(x={}));let aa=class{constructor(e,r,s){this._fbos=e,this._format=r,this._name=s}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=Pe(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}ensureFramebuffer(e,r){var s,a,i;this._handle&&((s=this._handle.fbo)==null?void 0:s.width)===e&&((a=this._handle.fbo)==null?void 0:a.height)===r||((i=this._handle)==null||i.release(),this._handle=this._fbos.acquire(e,r,this._name,this._format))}bind(e){var r;e.bindFramebuffer((r=this._handle)==null?void 0:r.fbo)}generateMipMap(){var e,r,s,a,i;(s=(r=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:r.descriptor)!=null&&s.hasMipmap&&((i=(a=this._handle)==null?void 0:a.getTexture())==null||i.generateMipmap())}},le=class{constructor(e,r,s,a,i=U.RGBA8UNORM_MIPMAP){this.output=s,this.content=a,this.fbo=new aa(e,i,r)}get valid(){return this.fbo.valid}},na=class{constructor(e){this.targets=[new le(e,"overlay color",R.Color,x.Color),new le(e,"overlay IM color",R.Color,x.ColorNoRasterImage),new le(e,"overlay highlight",R.Highlight,x.Highlight,U.RG8UINT),new le(e,"overlay water",R.Normal,x.WaterNormal),new le(e,"overlay occluded",R.Color,x.Occluded)],Nr()&&this.targets.push(new le(e,"overlay olid",R.ObjectAndLayerIdColor,x.ObjectAndLayerIdColor,U.RGBA8UNORM))}getTexture(e){var r;return(r=this.targets[e])==null?void 0:r.fbo.texture}dispose(e){if(e!==K.BACKGROUND)for(const r of this.targets)r.fbo.dispose();else this.targets[x.WaterNormal].fbo.dispose()}computeValidity(){return this.targets.reduce((e,r,s)=>r.valid?e|=1<<s:e,0)}};var cr;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})(cr||(cr={}));var j,tt;function oa(t){return t!=null&&!t.running}(function(t){t[t.Idle=0]="Idle",t[t.Rendering=1]="Rendering",t[t.Ready=2]="Ready",t[t.Fading=3]="Fading"})(j||(j={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA",t[t.COUNT=2]="COUNT"}(tt||(tt={}));var Ct;let qe=Ct=class extends Fe{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new Ct({cloudCover:this.cloudCover})}};c([Ae({cloudy:"cloudy"}),b({json:{write:{isRequired:!0}}})],qe.prototype,"type",void 0),c([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qe.prototype,"cloudCover",void 0),qe=Ct=c([B("esri.views.3d.environment.CloudyWeather")],qe);var Tt;let je=Tt=class extends Fe{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new Tt({fogStrength:this.fogStrength})}};c([Ae({foggy:"foggy"}),b({json:{write:{isRequired:!0}}})],je.prototype,"type",void 0),c([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],je.prototype,"fogStrength",void 0),je=Tt=c([B("esri.views.3d.environment.FoggyWeather")],je);var Ot;let Oe=Ot=class extends Fe{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Ot({cloudCover:this.cloudCover,precipitation:this.precipitation})}};c([Ae({rainy:"rainy"}),b({json:{write:{isRequired:!0}}})],Oe.prototype,"type",void 0),c([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Oe.prototype,"cloudCover",void 0),c([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Oe.prototype,"precipitation",void 0),Oe=Ot=c([B("esri.views.3d.environment.RainyWeather")],Oe);var Rt;let he=Rt=class extends Fe{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Rt({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};c([Ae({snowy:"snowy"}),b({json:{write:{isRequired:!0}}})],he.prototype,"type",void 0),c([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],he.prototype,"cloudCover",void 0),c([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],he.prototype,"precipitation",void 0),c([b({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],he.prototype,"snowCover",void 0),he=Rt=c([B("esri.views.3d.environment.SnowyWeather")],he);var $t;let Ge=$t=class extends Fe{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new $t({cloudCover:this.cloudCover})}};c([Ae({sunny:"sunny"}),b({json:{write:{isRequired:!0}}})],Ge.prototype,"type",void 0),c([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ge.prototype,"cloudCover",void 0),Ge=$t=c([B("esri.views.3d.environment.SunnyWeather")],Ge);const Be=1e4,la=1e5;class ha{constructor(){this.startTime=0,this._data=ct(null),this.coverage=0,this.absorption=0,this._readChannels=tt.RG,this.parallax=new ur,this.parallaxNew=new ur,this._anchorPoint=Ee(),this._fadeState=ct(f.HIDE),this._fadeFactor=ct(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case f.HIDE:return 0;case f.FADE_OUT:return 1-this.fadeFactor;case f.FADE_IN:return this.fadeFactor;case f.SHOW:case f.CROSS_FADE:return 1}}fade(e,r,s){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=s?Ar((r-this.startTime)/(ua*s),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(e,r),this._updateParallax(e)}_evaluateState(e,r){const s=e.relativeElevation,a=this._updateAnchorPoint(e);(s>1.7*Be||s<-Be||a>gr)&&this.opacity>0?this._startFade(f.HIDE,r):this.isFading||(s>Be||s<-.35*Be||a>da*gr?this.opacity>0&&this._startFade(f.FADE_OUT,r):oa(this.data)&&(this.opacity===0?this._startFade(f.FADE_IN,r):this.data.state===j.Ready&&(this.fadeState===f.SHOW?this._startFade(f.CROSS_FADE,r):this._startFade(f.SHOW,r))))}_updateParallax(e){const r=as(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(r-Ke.radius*Ke.radius,0))/Math.sqrt(r),rr(dr,this.parallax.anchorPoint,ce),Wt(this.parallax.transform,Q,ce[3],sr(ce)),rr(dr,this.parallaxNew.anchorPoint,ce),Wt(this.parallaxNew.transform,Q,ce[3],sr(ce))}_updateAnchorPoint(e){var r;return os(this._anchorPoint,e.eye),ls(this._anchorPoint,this._anchorPoint,Ke.radius),this.fadeState===f.HIDE&&((r=this.data)==null?void 0:r.state)===j.Ready?(q(this.parallax.anchorPoint,this._anchorPoint),0):ns(hs(ca,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,r){switch(this._fadeState.value=e,this.startTime=r,e){case f.CROSS_FADE:this.requestFade(),this._switchReadChannels(),q(this.parallaxNew.anchorPoint,this._anchorPoint);break;case f.FADE_IN:this.requestFade(),this._switchReadChannels(),q(this.parallax.anchorPoint,this._anchorPoint),q(this.parallaxNew.anchorPoint,this._anchorPoint);break;case f.FADE_OUT:this.requestFade();break;case f.SHOW:this._switchReadChannels(),q(this.parallax.anchorPoint,this._anchorPoint),q(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case f.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==j.Ready&&(this.data.state=j.Idle),this.fadeState){case f.CROSS_FADE:q(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=f.SHOW;break;case f.FADE_IN:this._fadeState.value=f.SHOW;break;case f.FADE_OUT:this._fadeState.value=f.HIDE;break;case f.SHOW:case f.HIDE:break;default:cs(this.fadeState)}}_switchReadChannels(){var e;((e=this.data)==null?void 0:e.state)===j.Ready&&(this._readChannels=1-this._readChannels,this.data.state=j.Fading)}get isFading(){return this.fadeState===f.FADE_OUT||this.fadeState===f.FADE_IN||this.fadeState===f.CROSS_FADE}}var f;(function(t){t[t.HIDE=0]="HIDE",t[t.FADE_IN=1]="FADE_IN",t[t.SHOW=2]="SHOW",t[t.CROSS_FADE=3]="CROSS_FADE",t[t.FADE_OUT=4]="FADE_OUT"})(f||(f={}));let ur=class{constructor(){this.anchorPoint=Ee(),this.radiusCurvatureCorrection=0,this.transform=N()}};const dr=Ie(0,0,1),ce=Vi(),ca=Ee(),ua=1.25,da=.5,gr=2e5;function ga(t){t.fragment.uniforms.add(new Se("cloudAbsorption",e=>e.clouds.absorption),new Se("cloudCoverage",e=>e.clouds.coverage)).code.add(w`vec4 lookupCloudsFromTextureArray(sampler2DArray cubeMap, vec3 rayDir) {
int faceIndex;
vec2 uv;
if(rayDir.z <= 0.0) {
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudCoverage), abs(dot(rayDir, vec3(0, 0, 1))));
float shading = clamp(1.0 - cloudAbsorption, 0.6, 1.0) * (1.0 - hazeFactor);
float totalTransmittance = hazeFactor;
return vec4(shading, totalTransmittance, shading, totalTransmittance);
}
if (abs(rayDir.x) >= abs(rayDir.y) && abs(rayDir.x) >= abs(rayDir.z)) {
if(rayDir.x > 0.0) {
faceIndex = 0;
uv = rayDir.yz / rayDir.x;
uv = vec2(-uv.x, uv.y);
} else {
faceIndex = 1;
uv = rayDir.yz / rayDir.x;
uv = vec2(-uv.x, -uv.y);
}
} else if (abs(rayDir.y) >= abs(rayDir.x) && abs(rayDir.y) >= abs(rayDir.z)) {
if(rayDir.y > 0.0) {
faceIndex = 2;
uv = rayDir.xz / rayDir.y;
} else {
faceIndex = 3;
uv = rayDir.xz / rayDir.y;
uv = vec2(uv.x, -uv.y);
}
} else {
if(rayDir.y < 0.0) {
faceIndex = 4;
uv = rayDir.xy / rayDir.z;
uv = vec2(uv.x, -uv.y);
} else {
faceIndex = 5;
uv = rayDir.xy / rayDir.z;
uv = vec2(uv.x, -uv.y);
}
}
uv = 0.5 * (uv + 1.0);
if(faceIndex != 5) {
uv.y = uv.y - 0.5;
}
uv.y = uv.y * 2.0;
vec4 s = texture(cubeMap, vec3(uv, float(faceIndex)));
return s;
}`)}let pa=class extends At{constructor(e,r){super(e,"sampler2DArray",Lt.Bind,(s,a)=>s.bindTexture(e,r(a)))}};function Bn(t){const e=t.fragment;e.constants.add("radiusCloudsSquared","float",_a).code.add(w`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),e.uniforms.add(new Se("radiusCurvatureCorrection",({clouds:l})=>l.parallax.radiusCurvatureCorrection)).code.add(w`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),e.code.add(w`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),qs(e),js(e);const r=Ie(.28,.175,.035);e.constants.add("RIM_COLOR","vec3",r),e.code.add(w`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${w.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${w.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${w.float(.2)} * pow(dirDotLight, ${w.float(10)}) * (1. - pow(sunsetTransition, ${w.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.include(ga),e.uniforms.add(new Xt("readChannelsRG",l=>l.clouds.readChannels===tt.RG),new pa("cubeMap",l=>{var u,d;return(d=(u=l.clouds.data)==null?void 0:u.cubeMap)==null?void 0:d.colorTexture})).code.add(w`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = lookupCloudsFromTextureArray(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),e.uniforms.add(new Kt("anchorPoint",l=>l.clouds.parallax.anchorPoint),new Kt("anchorPointNew",l=>l.clouds.parallaxNew.anchorPoint),new Zt("rotationClouds",l=>l.clouds.parallax.transform),new Zt("rotationCloudsNew",l=>l.clouds.parallaxNew.transform),new Se("cloudsOpacity",l=>l.clouds.opacity),new Se("fadeFactor",l=>l.clouds.fadeFactor),new Xt("crossFade",l=>l.clouds.fadeState===f.CROSS_FADE)).code.add(w`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const _a=(Ke.radius+la)**2;let ot=class extends At{constructor(e,r){super(e,"usampler2D",Lt.Pass,(s,a,i)=>s.bindTexture(e,r(a,i)))}};var ve;(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(ve||(ve={}));let jr=class extends Me{constructor(){super(...arguments),this.color=Ie(1,1,1)}};function fa(){const t=new ne;return t.include(Ft),t.fragment.uniforms.add(new Je("tex",e=>e.texture),new Gs("uColor",e=>e.color)),t.fragment.main.add(w`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),t}const ma=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:jr,build:fa},Symbol.toStringTag,{value:"Module"})),va={required:[]};R.Depth;let Gr=class extends us{precompile(e){return!!this.acquireTechniques(e)}consumes(){return va}get usedMemory(){return 0}get renderOccludedFlags(){return De.Occlude}get isDecoration(){return!1}get running(){return!1}modify(e,r){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}},ya=class extends Gr{},Kn=class extends Gr{},pr=class extends At{constructor(e,r){super(e,"ivec2",Lt.Pass,(s,a,i)=>s.setUniform2iv(e,r(a,i)))}},Br=class extends Me{};function xa(){const t=new ne,{outputs:e,fragment:r}=t;return t.include(Ft),r.uniforms.add(new ot("highlightTexture",s=>s.highlightTexture)),r.constants.add("outlineWidth","int",Math.ceil(rt)),r.constants.add("cellSize","int",X),e.add("fragGrid","uvec2"),r.main.add(w`ivec2 inputTextureSize = textureSize(highlightTexture, 0);
ivec2 cellBottomLeftCornerInput = ivec2(ivec2(floor(gl_FragCoord.xy) * vec2(cellSize)));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = texelFetch(highlightTexture, coordMid, 0).rg & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
texelFetch(highlightTexture,coord+ivec2(0,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(0,1),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,1),0).rg & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = outputValue;`),t}const X=32,rt=9,kr=.4,ba=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Br,blurSize:kr,build:xa,gridCellPixelSize:X,outlineSize:rt},Symbol.toStringTag,{value:"Module"}));function Nt(t){const{vertex:e}=t;e.uniforms.add(new ot("coverageTexture",r=>r.coverageTexture),new pr("highlightRenderCellCount",r=>H(_r,r.horizontalCellCount,r.verticalCellCount)),new pr("highlightTextureResolution",({highlightTexture:r})=>H(_r,r.descriptor.width,r.descriptor.height)),new at("highlightLevel",r=>r.highlightLevel)).constants.add("cellSize","int",X),t.varyings.add("sUV","vec2"),t.varyings.add("vOutlinePossible","float"),e.code.add(w`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),e.main.add(w`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = texelFetch(coverageTexture, cellPos, 0).rg;
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const _r=y();function wa(){const t=new ne;t.include(Nt);const{fragment:e}=t;return e.uniforms.add(new Je("blurInput",r=>r.highlightBlurTexture),new Hr("blurSize",r=>r.blurSize),new ot("highlightTexture",r=>r.highlightTexture),new Je("highlightOptionsTexture",r=>r.highlightOptionsTexture),new at("highlightLevel",r=>r.highlightLevel),new Vr("occludedIntensityFactor",r=>r.occludedFactor)),e.constants.add("inner","float",1-(rt-kr)/rt),t.include(Ur),e.main.add(w`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
uvec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),t}const Ca=Object.freeze(Object.defineProperty({__proto__:null,build:wa},Symbol.toStringTag,{value:"Module"}));let fr=class extends se{constructor(e,r){super(e,r,new ie(Ca,()=>re(()=>import("./ImageMaterial.glsl-B8OdYn9G.js").then(s=>s.H),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80]))))}initializePipeline(){return ee({blending:zr,colorWrite:te})}},Yr=class extends Me{constructor(){super(...arguments),this.blurSize=y()}};function Ta(){const t=new ne;return t.include(Nt),t.outputs.add("fragHighlight","vec2",0),t.fragment.uniforms.add(new Hr("blurSize",e=>e.blurSize),new Bs("blurInput",e=>e.blurInput)).main.add(w`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragHighlight = sum;
}`),t}const Oa=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Yr,build:Ta},Symbol.toStringTag,{value:"Module"}));let mr=class extends se{constructor(e,r){super(e,r,new ie(Oa,()=>re(()=>import("./ImageMaterial.glsl-B8OdYn9G.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80]))))}initializePipeline(){return ee({colorWrite:te})}},ft=class extends se{constructor(e,r){super(e,r,new ie(ba,()=>re(()=>import("./ImageMaterial.glsl-B8OdYn9G.js").then(s=>s.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80]))))}initializePipeline(){return ee({colorWrite:te})}},Ra=class extends Me{constructor(){super(...arguments),this.occludedFactor=ds,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function $a(){const t=new ne;t.include(Nt),t.include(Ur);const{fragment:e}=t;return t.outputs.add("fragSingleHighlight","vec2",0),e.uniforms.add(new ot("highlightTexture",r=>r.highlightTexture),new at("highlightLevel",r=>r.highlightLevel)),e.main.add(w`ivec2 iuv = ivec2(gl_FragCoord.xy);
uvec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),t}const Sa=Object.freeze(Object.defineProperty({__proto__:null,build:$a},Symbol.toStringTag,{value:"Module"}));let vr=class extends se{constructor(e,r){super(e,r,new ie(Sa,()=>re(()=>import("./ImageMaterial.glsl-B8OdYn9G.js").then(s=>s.c),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80]))))}initializePipeline(){return ee({colorWrite:te})}};const Da=[];new ye(p.POSITION,3,Z.FLOAT,0,12);new ye(p.POSITION,2,Z.FLOAT,0,8);new ye(p.POSITION,2,Z.FLOAT,0,12),new ye(p.UV0,2,Z.HALF_FLOAT,8,12);new ye(p.POSITION,2,Z.FLOAT,0,16),new ye(p.UV0,2,Z.FLOAT,8,16);let ke=class extends ks{constructor(){super(...arguments),this.produces=dt.HIGHLIGHTS,this.consumes={required:[dt.HIGHLIGHTS,"highlights"]},this._downsampleDrawParameters=new Br,this._passParameters=new Ra,this._highlightBlurDrawParameters=new Yr,this._grid=new Pa}initialize(){this.addHandles([pe(()=>this._updateOptionsTexture(),()=>{},bt)])}destroy(){this._grid.coverage=Pe(this._grid.coverage),this._grid.vao=Dt(this._grid.vao),this._passParameters.highlightOptionsTexture=Pe(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(this._passParameters.highlightOptionsTexture==null){const e=new Fr(16,2);e.internalFormat=gs.RGBA,e.samplingMode=Er.NEAREST,this._passParameters.highlightOptionsTexture=new Pt(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(Ia(this.view.state.highlights)),this.requestRender(K.UPDATE)}precompile(){this.techniques.precompile(ft),this.techniques.precompile(vr),this.techniques.precompile(mr),this.techniques.precompile(fr)}render(e){const r=e.find(({name:n})=>n===dt.HIGHLIGHTS),{techniques:s,bindParameters:a}=this;if(!a.decorations)return r;if(!s.get(ft).compiled)return this.requestRender(K.UPDATE),r;const i=e.find(({name:n})=>n==="highlights").getTexture();return this._renderHighlightPostprocess(i,r),r}_prepareAndDownSample(e){var o;this._gridUpdateResources(e);const r=this.techniques.get(ft),s=this._gridComputeCoverage(r,e),{horizontalCellCount:a,verticalCellCount:i}=s,n=this._passParameters;return n.horizontalCellCount=a,n.verticalCellCount=i,n.coverageTexture=(o=s.coverage)==null?void 0:o.getTexture(),s}_renderGrid(e){const r=e.verticalCellCount*e.horizontalCellCount;this.renderingContext.bindVAO(e.vao),this.renderingContext.drawElementsInstanced(ps.TRIANGLES,6,Z.UNSIGNED_BYTE,0,r)}_renderHighlightPostprocess(e,r){var Vt;const{fboCache:s,techniques:a,bindParameters:i,_passParameters:n,renderingContext:o}=this,l=a.get(vr),u=a.get(mr),d=a.get(fr);if(!d.compiled||!u.compiled||!l.compiled)return void this.requestRender(K.UPDATE);n.highlightTexture=e;const m=this._prepareAndDownSample(e),{width:O,height:_}=e.descriptor;n.highlightTexture=e;const{camera:T}=i,{fullWidth:xe,fullHeight:be,pixelRatio:Le,fullViewport:lt}=T,we=Math.ceil(xe/Le),Ce=Math.ceil(be/Le),{_highlightBlurDrawParameters:v}=this,D=this.view.stage.renderView.renderer,{highlights:Ht}=i;for(let Ne=0;Ne<Ht.length;++Ne){const{name:Jr}=Ht[Ne];if(!D.hasHighlight(Jr))continue;n.highlightLevel=Ne,o.setClearColor(0,0,0,0);const ht=s.acquire(O,_,"single highlight",U.RG8UNORM);o.bindFramebuffer(ht.fbo),o.setViewport(0,0,O,_),o.clear(J.COLOR),o.bindTechnique(l,i,n),this._renderGrid(m),v.blurInput=ht.getTexture(),H(v.blurSize,1/we,0);const He=s.acquire(we,Ce,"single highlight blur h",U.RG8UNORM);o.unbindTexture((Vt=He.fbo)==null?void 0:Vt.colorTexture),o.bindFramebuffer(He.fbo),o.setViewport(0,0,we,Ce),o.clear(J.COLOR),o.bindTechnique(u,i,n,v),this._renderGrid(m),ht.release(),H(v.blurSize,0,1/Ce),n.highlightBlurTexture=He.getTexture(),o.bindFramebuffer(r.fbo),o.setViewport4fv(lt),o.bindTechnique(d,i,n,v),this._renderGrid(m),He.release()}n.coverageTexture=n.highlightTexture=null}_gridUpdateResources(e){const r=this._grid,{width:s,height:a}=e.descriptor;if(r.horizontalCellCount=Math.ceil(s/X),r.verticalCellCount=Math.ceil(a/X),r.vao)return;const i=this.renderingContext,n=ir.createIndex(i,zt.STATIC_DRAW,Ea);r.vao=new sa(i,Ys,new Map([["geometry",Da]]),new Map([["geometry",ir.createVertex(i,zt.STATIC_DRAW)]]),n)}_gridComputeCoverage(e,r){var d;const s=this.renderingContext,a=this._grid,i=r.descriptor,n=Math.ceil(i.width/X),o=Math.ceil(i.height/X);this._downsampleDrawParameters.input=r;const{highlights:l}=this.bindParameters;(d=a.coverage)==null||d.release();const u=this.fboCache.acquire(n,o,"highlight coverage",l.length>Qr?U.RG8UINT:U.R8UINT);return a.coverage=u,s.bindFramebuffer(u.fbo),s.bindTechnique(e,this.bindParameters,this._passParameters,this._downsampleDrawParameters),s.setViewport(0,0,n,o),s.screen.draw(),a}get test(){}};c([b()],ke.prototype,"produces",void 0),c([b()],ke.prototype,"consumes",void 0),ke=c([B("esri.views.3d.webgl-engine.effects.highlight.Highlight")],ke);class Pa{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}function Ia(t){const e=new Uint8Array(128);let r=0;for(const s of t){const a=4*r,i=4*r+64;++r;const{color:n}=s,o=s.haloColor??n;e[a+0]=n.r,e[a+1]=n.g,e[a+2]=n.b,e[a+3]=s.fillOpacity*n.a*255,e[i+0]=o.r,e[i+1]=o.g,e[i+2]=o.b,e[i+3]=s.haloOpacity*o.a*255}return e}let Aa=0;function Fa(t){let e=0;for(const s of t){const{name:a}=s;e+=a.length;const{color:i,fillOpacity:n,haloColor:o,haloOpacity:l}=s;e+=i.r+i.g+i.b+i.a+n,e+=o?o.r+o.g+o.b+o.a+l:0}const r=t.at(0);if(r){const{shadowOpacity:s,shadowDifference:a,shadowColor:i}=r;e+=s+a+i.r+i.g+i.b+i.a}return Aa+++(e>=0?0:1)}const Ea=new Uint8Array([0,1,2,2,1,3]);function Ma(t,e,r,s,a,i=0){const{highlights:n}=s,o=n.length>1?e.acquire(r.width,r.height,"highlight mix",n.length>Qr?U.RG8UINT:U.R8UINT):null,{gl:l}=t;if(o){const d=t.getBoundFramebufferObject();t.bindFramebuffer(o.fbo),l.clearBufferuiv(l.COLOR,0,[0,0,0,0]),t.bindFramebuffer(d)}const u=o==null?void 0:o.getTexture();s.highlightMixTexture=u,H(s.highlightMixOrigin,i,0),n.forEach((d,m)=>{if(m>0){const O=Pt.TEXTURE_UNIT_FOR_UPDATES;t.bindTexture(u,O),t.setActiveTexture(O),l.copyTexSubImage2D(_s.TEXTURE_2D,0,0,0,i,0,r.width,r.height),t.bindTexture(null,O)}t.clear(J.DEPTH),s.highlightLevel=m,a()}),s.highlightLevel=null,s.highlightMixTexture=null,o==null||o.release()}const Qr=4;let La=class{constructor(e,r,s,a){this.material=e,this.output=r,this.techniques=s,this.textures=a}},Na=class{constructor(e,r,s,a){this._textures=e,this._techniques=r,this.materialChanged=s,this.requestRender=a,this._id2glMaterialRef=new Wi}dispose(){this._textures.destroy()}acquire(e,r,s){this._ownMaterial(e);const a=e.produces.get(r);if(!(a!=null&&a(s)))return null;let i=this._id2glMaterialRef.get(s,e.id);if(i==null){const n=e.createGLMaterial(new La(e,s,this._techniques,this._textures));i=new Ha(n),this._id2glMaterialRef.set(s,e.id,i)}return i.ref(),i.glMaterial}release(e,r){const s=this._id2glMaterialRef.get(r,e.id);s!=null&&(s.unref(),s.referenced||(Dt(s.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&fs.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Ha=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,me(this._refCnt>=0)}get referenced(){return this._refCnt>0}};var st;(function(t){t[t.Immediate=0]="Immediate",t[t.FadeWithWeather=1]="FadeWithWeather"})(st||(st={}));let Va=class{constructor(e){this.shadowMap=e,this.slot=E.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=Et.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new nt,this._inverseViewport=y(),this._oldLighting=new gt,this._newLighting=new gt,this._fadedLighting=new gt,this._lighting=this._newLighting,this.ssr=new Ua,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=y(),this.highlightMixTexture=null,this.hudRenderStyle=qi.Occluded,this.hudOccludedFragmentOpacity=1,this.snowCover=!1,this.clouds=new ha,this.shadowHighlightsVisible=!1}destroy(){this._camera=null,this.contentCamera=null,this.depth=null,this.geometryDepth=null,this.mainDepth=null,this.overlay=null,this.ssao=null,this.terrainDepth=null}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,r,s,a){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=r,this._newLighting.globalFactor=s,this._newLighting.set(e),a===st.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return this.highlightLevel==null?null:this.highlights[this.highlightLevel]}},Ua=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=N()}},Wa=class{constructor(e,r,s){this.rctx=e,this.techniques=s,this.lastFrameCamera=new nt,this.output=R.Color,this.renderOccludedMask=Ze,this.time=ms(0),this.bind=new Va(r),this.bind.alignPixelEnabled=!0}};const Ze=De.Occlude|De.OccludeAndTransparent|De.OccludeAndTransparentStencil;let $e=class extends nt{constructor(){super(...arguments),this._projectionMatrix=N()}get projectionMatrix(){return this._projectionMatrix}};c([b()],$e.prototype,"_projectionMatrix",void 0),c([b({readOnly:!0})],$e.prototype,"projectionMatrix",null),$e=c([B("esri.views.3d.webgl-engine.lib.CascadeCamera")],$e);var it;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(it||(it={}));let Ye=class{constructor(){this.camera=new $e,this.lightMat=N()}},za=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},qa=class{constructor(e,r){this._fbos=e,this._viewingMode=r,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new za,this._projectionView=N(),this._projectionViewInverse=N(),this._modelViewLight=N(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=It(),this._cascades=[new Ye,new Ye,new Ye,new Ye],this._lastOrigin=null,this._enabled=!1,this._maxTextureWidth=Math.min(vs("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture(Ve)}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return qt(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeMainBuffer(){this._handle=Pe(this._handle)}disposeOffscreenBuffers(){this.disposeMainBuffer(),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Ar(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)vt[e]=this._cascades[e];return vt.length=this._numCascades,vt}start(e,r,s,a,i){me(this.enabled);const{near:n,far:o}=Qa(s);this._computeCascadeDistances(n,o,a),this._textureHeight=this._computeTextureHeight(e,i,a),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:u}=e;for(let d=0;d<this._numCascades;++d)this._constructCascade(d,u,l,r);this._lastOrigin=null,this.clear()}finish(){me(this.enabled)}getShadowMapMatrices(e){if(!this._lastOrigin||!ys(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||Ee(),q(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){jt(Tr,this._cascades[r].lightMat,e);for(let s=0;s<16;++s)Or[16*r+s]=Tr[s]}}return Or}moveSnapshot(e){var r,s;me(this.enabled),(r=this._snapshots[e])==null||r.release(),this._snapshots[e]=this._handle,(s=this._handle)==null||s.setName(e===it.Highlight?"shadow map highlight":"shadow map excluding highlight"),this._handle=null}copySnapshot(e){var o,l,u,d;if(!this.enabled||!((l=(o=this._handle)==null?void 0:o.getTexture(Ve))==null?void 0:l.descriptor))return;(u=this._snapshots[e])==null||u.release();const s=e===it.Highlight?"shadow map highlight":"shadow map excluding highlight",a=this._acquireFBO(s);this._snapshots[e]=a;const i=(d=this._handle)==null?void 0:d.fbo;if(!i||!(a!=null&&a.fbo))return void console.error("No FBO");const{rctx:n}=this._fbos;n.blitFramebuffer(i,a.fbo,J.DEPTH)}getSnapshot(e){var r;return this.enabled?(r=this._snapshots[e])==null?void 0:r.getTexture(Ve):null}clear(){this._ensureFbo(),this.bindFbo(),this._fbos.rctx.clear(J.DEPTH)}_computeTextureHeight({pixelRatio:e,fullWidth:r,fullHeight:s},a,i){const n=Math.min(window.devicePixelRatio,a)/e,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Qs(Math.max(r,s)*n*o,this._maxTextureWidth/this._numCascades)}_ensureFbo(){var e,r,s,a;((r=(e=this._handle)==null?void 0:e.fbo)==null?void 0:r.width)===this._textureWidth&&((s=this._handle)==null?void 0:s.fbo.height)===this._textureHeight||((a=this._handle)==null||a.release(),this._handle=this._acquireFBO("shadow map"))}_acquireFBO(e){var s;const r=this._fbos.acquire(this._textureWidth,this._textureHeight,e,Xs.DEPTH16);return(s=r.getTexture(Ve))==null||s.setShadowFiltering(!0),r}_discardSnapshot(e){this._snapshots[e]=Pe(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}bindFbo(){var e;this._fbos.rctx.bindFramebuffer((e=this._handle)==null?void 0:e.fbo)}_constructCascade(e,r,s,a){const i=this._cascades[e],n=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],l=(r[10]*n+r[14])/Math.abs(r[11]*n+r[15]),u=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]);me(l<u);for(let _=0;_<8;++_){qt(yr,_%4==0||_%4==3?-1:1,_%4==0||_%4==1?-1:1,_<4?l:u,1);const T=L[_];xs(T,yr,this._projectionViewInverse),T[0]/=T[3],T[1]/=T[3],T[2]/=T[3]}bs(mt,L[0]),i.camera.viewMatrix=jt(ja,this._modelViewLight,mt);for(let _=0;_<8;++_)Mr(L[_],L[_],i.camera.viewMatrix);let d=L[0][2],m=L[0][2];for(let _=1;_<8;++_)d=Math.min(d,L[_][2]),m=Math.max(m,L[_][2]);d-=200,m+=200,i.camera.near=-m,i.camera.far=-d,Ya(s,a,d,m,i.camera),wt(i.lightMat,i.camera.projectionMatrix,i.camera.viewMatrix);const O=this._textureHeight;i.camera.viewport=[e*O,0,O,O]}_setupMatrices(e,r){wt(this._projectionView,e.projectionMatrix,e.viewMatrix),ws(this._projectionViewInverse,this._projectionView);const s=this._viewingMode===Pr.Global?e.eye:Lr(mt,0,0,1);Cs(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],s)}_computeCascadeDistances(e,r,s){const a=s?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(zi(r/e,4)),a);const i=(r-e)/this._numCascades,n=(r/e)**(1/this._numCascades);let o=e,l=e;for(let u=0;u<this._numCascades+1;++u)this._cascadeDistances[u]=Ts(o,l,this.settings.splitSchemeLambda),o*=n,l+=i}get test(){}};const ja=N(),yr=It(),L=[];for(let t=0;t<8;++t)L.push(It());const xr=y(),br=y(),Ga=y(),wr=y(),Cr=y(),mt=Ee(),vt=[],Tr=N(),Or=Q.concat(Q,Q,Q,Q),M=y(),ue=y(),Y=[y(),y(),y(),y()],C=y(),yt=y(),z=y(),Re=y(),de=y(),ge=y(),Qe=y();function Ba(t,e,r,s,a,i,n,o){H(M,0,0);for(let v=0;v<4;++v)k(M,M,t[v]);_e(M,M,.25),H(ue,0,0);for(let v=4;v<8;++v)k(ue,ue,t[v]);_e(ue,ue,.25),Te(Y[0],t[4],t[5],.5),Te(Y[1],t[5],t[6],.5),Te(Y[2],t[6],t[7],.5),Te(Y[3],t[7],t[4],.5);let l=0,u=Gt(Y[0],M);for(let v=1;v<4;++v){const D=Gt(Y[v],M);D<u&&(u=D,l=v)}fe(C,Y[l],t[l+4]);const d=C[0];let m,O;C[0]=-C[1],C[1]=d,fe(yt,ue,M),S(yt,C)<0&&Rs(C,C),Te(C,C,yt,r),Bt(C,C),m=O=S(fe(z,t[0],M),C);for(let v=1;v<8;++v){const D=S(fe(z,t[v],M),C);D<m?m=D:D>O&&(O=D)}$s(s,M),_e(z,C,m-e),k(s,s,z);let _=-1,T=1,xe=0,be=0;for(let v=0;v<8;++v){fe(Re,t[v],s),Bt(Re,Re);const D=C[0]*Re[1]-C[1]*Re[0];D>0?D>_&&(_=D,xe=v):D<T&&(T=D,be=v)}oe(_>0,"leftArea"),oe(T<0,"rightArea"),_e(de,C,m),k(de,de,M),_e(ge,C,O),k(ge,ge,M),Qe[0]=-C[1],Qe[1]=C[0];const Le=ze(s,t[be],ge,k(z,ge,Qe),1,a),lt=ze(s,t[xe],ge,z,1,i),we=ze(s,t[xe],de,k(z,de,Qe),1,n),Ce=ze(s,t[be],de,z,1,o);oe(Le,"rayRay"),oe(lt,"rayRay"),oe(we,"rayRay"),oe(Ce,"rayRay")}function g(t,e){return 3*e+t}const Rr=y();function I(t,e){return H(Rr,t[e],t[e+3]),Rr}const P=y(),h=ji();function ka(t,e,r,s,a){fe(P,r,s),_e(P,P,.5),h[0]=P[0],h[1]=P[1],h[2]=0,h[3]=P[1],h[4]=-P[0],h[5]=0,h[6]=P[0]*P[0]+P[1]*P[1],h[7]=P[0]*P[1]-P[1]*P[0],h[8]=1,h[g(0,2)]=-S(I(h,0),t),h[g(1,2)]=-S(I(h,1),t);let i=S(I(h,0),r)+h[g(0,2)],n=S(I(h,1),r)+h[g(1,2)],o=S(I(h,0),s)+h[g(0,2)],l=S(I(h,1),s)+h[g(1,2)];i=-(i+o)/(n+l),h[g(0,0)]+=h[g(1,0)]*i,h[g(0,1)]+=h[g(1,1)]*i,h[g(0,2)]+=h[g(1,2)]*i,i=1/(S(I(h,0),r)+h[g(0,2)]),n=1/(S(I(h,1),r)+h[g(1,2)]),h[g(0,0)]*=i,h[g(0,1)]*=i,h[g(0,2)]*=i,h[g(1,0)]*=n,h[g(1,1)]*=n,h[g(1,2)]*=n,h[g(2,0)]=h[g(1,0)],h[g(2,1)]=h[g(1,1)],h[g(2,2)]=h[g(1,2)],h[g(1,2)]+=1,i=S(I(h,1),e)+h[g(1,2)],n=S(I(h,2),e)+h[g(2,2)],o=S(I(h,1),r)+h[g(1,2)],l=S(I(h,2),r)+h[g(2,2)],i=-.5*(i/n+o/l),h[g(1,0)]+=h[g(2,0)]*i,h[g(1,1)]+=h[g(2,1)]*i,h[g(1,2)]+=h[g(2,2)]*i,i=S(I(h,1),e)+h[g(1,2)],n=S(I(h,2),e)+h[g(2,2)],o=-n/i,h[g(1,0)]*=o,h[g(1,1)]*=o,h[g(1,2)]*=o,a[0]=h[0],a[1]=h[1],a[2]=0,a[3]=h[2],a[4]=h[3],a[5]=h[4],a[6]=0,a[7]=h[5],a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=h[6],a[13]=h[7],a[14]=0,a[15]=h[8]}function Ya(t,e,r,s,a){const i=1/L[0][3],n=1/L[4][3];me(i<n);let o=i+Math.sqrt(i*n);const l=Math.sin(Os(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));o/=l,Ba(L,o,l,xr,br,Ga,wr,Cr),ka(xr,br,wr,Cr,a.projectionMatrix),a.projectionMatrix[10]=2/(r-s),a.projectionMatrix[14]=-(r+s)/(r-s)}function Qa(t){let{near:e,far:r}=t;return e<2&&(e=2),r<2&&(r=2),e>=r&&(e=2,r=4),{near:e,far:r}}let $r=class extends se{constructor(e,r){super(e,r,new ie(ma,()=>re(()=>import("./ImageMaterial.glsl-B8OdYn9G.js").then(s=>s.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80]))))}initializePipeline(e){return e.hasAlpha?ee({blending:zr,colorWrite:te}):ee({colorWrite:te})}},Xr=class extends Ks{constructor(){super(...arguments),this.hasAlpha=!1}};c([A()],Xr.prototype,"hasAlpha",void 0);let Kr=class extends Me{constructor(){super(...arguments),this.overlayIndex=G.INNER,this.opacity=1}};function Xa(){const t=new ne;return t.include(Ft),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.uniforms.add(new at("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Vr("opacity",e=>e.opacity)),t.fragment.main.add(w`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),t}const Ka=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Kr,build:Xa},Symbol.toStringTag,{value:"Module"}));let Sr=class extends se{constructor(e,r){super(e,r,new ie(Ka,()=>re(()=>import("./ImageMaterial.glsl-B8OdYn9G.js").then(s=>s.O),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80]))))}},V=class extends ya{constructor(t){super(t),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Kr,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Ss,this._passParameters=new jr,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new nt,this.events=new Ds,this.longitudeCyclical=null,this.produces=new Map([[E.DRAPED_MATERIAL,e=>e!==R.Highlight||this.hasHighlights],[E.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const t=this._view,e=t.stage,r=e.renderer.fboCache,{waterTextures:s,techniques:a}=e.renderView;this._renderContext=new Wa(this._rctx,new qa(r,t.state.viewingMode),a),this.addHandles([pe(()=>s.updating,()=>this.events.emit("content-changed"),kt),pe(()=>this.spatialReference,o=>this._localOriginFactory=new Mi(o),kt),Ps(()=>t.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),pe(()=>Fa(t.state.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,bt),pe(()=>t.state.highlights,o=>{this._bindParameters.highlights=o,this._bindParameters.highlightOrderMap=t.state.highlightOrderMap},bt),t.resourceController.scheduler.registerTask(Is.OVERLAY_RENDERER,this)]);const{_bindParameters:i,_camera:n}=this;n.near=1,n.far=1e4,n.relativeElevation=null,i.slot=E.DRAPED_MATERIAL,i.mainDepth=null,i.camera=n,i.oitPass=Et.NONE,i.updateLighting([new Zs(As())],0,0,st.Immediate)}destroy(){this._renderers.forEach(t=>t.destroy()),this._renderers.clear(),this._passParameters.texture=Dt(this._passParameters.texture),this.disposeOverlays(),this._renderContext=null,this._sortedRenderers.prune()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view.stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._pluginContext.materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(t){const e=new Na(this._view.stage.renderView.textures,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._pluginContext={...t,materials:e},this._techniques.precompile(Sr)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Ue(this._renderers,t=>t.updating||t.canCompact)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(t){for(const e of this._renderers.values()){const r=e.getMaterialRenderer(t);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(t=>t.drapeSource.layer).filter(t=>!!t)}registerDrapeSource(t,e){const r=this._renderers.get(t);r!=null&&r.destroy(),this._renderers.set(t,e),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in t&&this.addHandles(pe(()=>t.fullOpacity,()=>this.events.emit("content-changed")),t)}removeDrapeSourceRenderer(t){if(t==null)return;const e=this._renderers.get(t);e!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(t),this.removeHandles(t),e.destroy())}computeValidity(){var t;return((t=this._renderTargets)==null?void 0:t.computeValidity())??0}releaseRenderTargets(t){var e;(e=this._renderTargets)==null||e.dispose(t)}get overlays(){return this._overlays??[]}ensureDrapeTargets(t){this._hasTargetWithoutRasterImage=!!this._overlays&&ut(t,e=>e.drapeTargetType===Li.WithoutRasterImage)}ensureDrapeSources(t){this._overlays?(this._hasDrapedFeatureSource=ut(t,e=>e.drapeSourceType===We.Features),this._hasDrapedRasterSource=ut(t,e=>e.drapeSourceType===We.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(t,e,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new na(this._stage.renderer.fboCache),this._overlays=[new hr,new hr]),this.ensureDrapeTargets(t),this.ensureDrapeSources(e),this._bindParameters.overlayStretch=r}disposeOverlays(){var t;this._overlays=null,(t=this._renderTargets)==null||t.dispose(K.UPDATE),this._renderTargets=null,this.events.emit("textures-disposed")}_useOverlayColorInsteadOfColorNoRasterImage(t){return t===x.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource}getTexture(t){var e,r;return this._useOverlayColorInsteadOfColorNoRasterImage(t)?(e=this._renderTargets)==null?void 0:e.getTexture(x.Color):(r=this._renderTargets)==null?void 0:r.getTexture(t)}get running(){return this.updating}runTask(t){this._processDrapeSources(t,()=>!0)}_processDrapeSources(t,e){let r=!1;for(const[s,a]of this._renderers){if(t.done)break;(s.destroyed||e(s))&&a.commitChanges()&&(r=!0,t.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers(),t.madeProgress()),this.compact(t),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Ue(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"))}compact(t){let e=!1;for(const r of this._renderers.values()){if(t.done)break;e=r.compact(t)||e}return e&&this.notifyChange("updating"),e}hasHighlight(t){return Ue(this._renderers,e=>e.hasHighlight(t))}processSyncDrapeSources(){this._processDrapeSources(Fs,t=>t.updatePolicy===Ni.SYNC)}get isEmpty(){return!pt.OVERLAY_DRAW_DEBUG_TEXTURE&&Yt(this._renderers,t=>t.isEmpty)}get hasWater(){const t=Ue(this._renderers,({hasWater:e})=>e);return t!==this._hasWater&&(this._hasWater=t,this.events.emit("has-water")),this._hasWater}get rendersOccludedDraped(){const t=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=xt,++this._techniques.precompiling;const e=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=t,e}renders(t){var a,i;if(pt.OVERLAY_DRAW_DEBUG_TEXTURE&&t!==x.Occluded&&t!==x.Highlight)return!0;if(!this._overlays)return!1;const e=this._overlays[G.INNER];for(const n of this._overlays)n.setupGeometryViews(this.longitudeCyclical);if(!e.hasSomeSizedView())return!1;const r=this._renderContext.output;this._renderContext.output=((i=(a=this._renderTargets)==null?void 0:a.targets.find(n=>n.content===t))==null?void 0:i.output)??R.Color,++this._techniques.precompiling;const s=this._sortedRenderers.some(({renderer:n})=>n.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.output=r,s}get mode(){var t;return this.isEmpty?ve.Disabled:this.hasWater&&this.renders(x.WaterNormal)?ve.EnabledWithWater:(t=this._renderTargets)!=null&&t.getTexture(x.Color)?ve.Enabled:ve.Disabled}updateAnimation(t){let e=!1;return this._renderers.forEach(r=>e=r.updateAnimation(t)||e),e&&this.parent.requestRender(K.BACKGROUND),e}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(t){if(!this._overlays||!this._renderTargets)return!1;const e=this._bindParameters;e.alignPixelEnabled=t.alignPixelEnabled,++this._techniques.precompiling;for(const r of this._renderTargets.targets){if(r.content===x.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const s=r.output;this._renderContext.output=s,e.slot=s===R.Normal?E.DRAPED_WATER:E.DRAPED_MATERIAL,s===R.Highlight&&(e.highlightMixTexture=e.highlights.length>1?this._rctx.emptyTexture:null),r.content===x.Occluded&&(this._renderContext.renderOccludedMask=xt),this._sortedRenderers.forAll(({drapeSource:a,renderer:i})=>{r.content===x.ColorNoRasterImage&&a.drapeSourceType===We.RasterImage||i.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=Ze,e.highlightMixTexture=null}return--this._techniques.precompiling,!0}drawOverlays(t,e){if(!this._overlays||!this._renderTargets)return;for(const s of this._overlays)s.setupGeometryViews(this.longitudeCyclical);this._bindParameters.alignPixelEnabled=t.alignPixelEnabled;const r=this.allSourcesOccluders;for(const s of this._renderTargets.targets){if(e===K.BACKGROUND&&s.content!==x.WaterNormal||s.content===x.ColorNoRasterImage&&!this._needsColorWithoutRasterImage||s.content===x.Occluded&&r)continue;const a=this._drawTarget(G.INNER,s),i=this._drawTarget(G.OUTER,s);(a||i)&&s.fbo.generateMipMap()}}_drawTarget(t,e){const r=this._overlays[t],s=r.canvasGeometries;if(s.numViews===0)return!1;const a=this._view.state.contentPixelRatio;this._screenToWorldRatio=a*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const{output:i}=e;if(this.isEmpty||i===R.Normal&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:n,_camera:o,_renderContext:l,_bindParameters:u}=this;if(o.pixelRatio=r.pixelRatio*a,l.output=i,u.screenToWorldRatio=this._screenToWorldRatio,u.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,u.slot=i===R.Normal?E.DRAPED_WATER:E.DRAPED_MATERIAL,e.content===x.Occluded&&(l.renderOccludedMask=xt),!this.renders(e.content))return l.renderOccludedMask=Ze,!1;const{resolution:d}=r,m=t===G.INNER,O=m?0:d;if(n.setViewport(O,0,d,d),this._bindTargetFBO(e),m)if(e.output!==R.Highlight)n.setClearColor(0,0,0,0),n.clear(J.COLOR);else{const{gl:_}=n;_.clearBufferuiv(_.COLOR,0,[0,0,0,0])}if(pt.OVERLAY_DRAW_DEBUG_TEXTURE&&e.content!==x.Occluded&&e.content!==x.Highlight){this._techniques.precompile($r,St);const _=this._techniques.get($r,St);for(let T=0;T<s.numViews;T++)this._setViewParameters(s.extents[T],r),this._ensureDebugPatternResources(r.resolution,Ja[t]),n.bindTechnique(_,u,this._passParameters),n.screen.draw()}if(e.output===R.Highlight){const{fboCache:_}=this._stage.renderer,T=this._resolution;this._bindTargetFBO(e),Ma(n,_,{width:T,height:T},u,()=>this._renderAllGeometry(t,e),O)}else this._renderAllGeometry(t,e);return n.bindFramebuffer(null),l.renderOccludedMask=Ze,!0}get allSourcesOccluders(){var e;const t=Yt(this._renderers,r=>r.hasOnlyOccluders);return((e=this._renderers)==null?void 0:e.size)>0&&t}_renderAllGeometry(t,e){const r=this._overlays[t],s=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:a,renderer:i})=>{if(e.content===x.ColorNoRasterImage&&a.drapeSourceType===We.RasterImage)return;const{fullOpacity:n}=a,o=n!=null&&n<1&&e.output===R.Color&&this._bindTemporaryFBO();for(let l=0;l<s.numViews;l++)this._setViewParameters(s.extents[l],r),i.render(this._renderContext);if(o){this._bindTargetFBO(e),this._overlayParameters.texture=o.getTexture(),this._overlayParameters.opacity=n,this._overlayParameters.overlayIndex=t;const l=this._techniques.get(Sr);this._rctx.bindTechnique(l,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),o.release()}})}_bindTargetFBO(t){const e=this._resolution,r=2*e;t.fbo.ensureFramebuffer(r,e),t.fbo.bind(this._rctx)}_bindTemporaryFBO(){const t=this._resolution,e=2*t,r=this._stage.renderer.fboCache,s=r.acquire(e,t,"overlay tmp");return r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(J.COLOR),s}get _resolution(){var t;return((t=this._overlays)==null?void 0:t[G.INNER].resolution)??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(t,e,r,s){var i;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let a=0;for(const{renderer:n}of this._sortedRenderers)a=((i=n.intersect)==null?void 0:i.call(n,t,e,r,s,a))??a}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const t=this._view.map.allLayers,e=t.length;this._renderers.forEach((r,s)=>{const a=t.indexOf(s.layer),i=a>=0,n=s.renderGroup??(i?tr.MapLayer:tr.ViewLayer),o=s.drapeSourcePriorityOffset??0,l=e*n+(i?a:0)+o;this._sortedRenderers.push(new Za(s,r,l))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(t,e){const r=this._camera;r.viewport=[0,0,e.resolution,e.resolution],Es(r.projectionMatrix,0,t[2]-t[0],0,t[3]-t[1],r.near,r.far),Ms(r.viewMatrix,[-t[0],-t[1],0])}_ensureDebugPatternResources(t,e){if(Lr(this._passParameters.color,e[0],e[1],e[2]),this._passParameters.texture)return;const r=new Uint8Array(t*t*4);let s=0;for(let i=0;i<t;i++)for(let n=0;n<t;n++){const o=Math.floor(n/10),l=Math.floor(i/10);o<2||l<2||10*o>t-20||10*l>t-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&o&&1&l?1&n^1&i?0:255:1&o^1&l?0:128)}const a=new Fr(t);a.samplingMode=Er.NEAREST,this._passParameters.texture=new Pt(this._rctx,a,r)}get test(){}};c([b()],V.prototype,"hasHighlights",void 0),c([b()],V.prototype,"_sortedDrapeSourceRenderersDirty",void 0),c([b({constructOnly:!0})],V.prototype,"parent",void 0),c([b({readOnly:!0})],V.prototype,"_techniques",null),c([b({type:Boolean,readOnly:!0})],V.prototype,"updating",null),c([b()],V.prototype,"isEmpty",null),c([b({readOnly:!0})],V.prototype,"rendersOccludedDraped",null),V=c([B("esri.views.3d.terrain.OverlayRenderer")],V);class Za{constructor(e,r,s){this.drapeSource=e,this.renderer=r,this.index=s}}const Ja=[[1,.5,.5],[.5,.5,1]],en=-2,xt=De.OccludeAndTransparent,St=new Xr;St.hasAlpha=!0;class wo{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=N(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Ls(),this.layerViewUid=r.layerViewUid,this.graphicUid=r.graphicUid,this.castShadow=r.castShadow??!1,r.objectShaderTransformation&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){Ns(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=N()),wt(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Di()),Mr(Pi(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*Ii(this.shaderTransformation)),this._boundingSphere):Si}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}let tn=class extends Js{constructor(){super(...arguments),this._pp0=Ie(0,0,1),this._pp1=Ie(0,0,0)}intersect(e,r,s,a,i,n){return Jt(e,s,a,i,void 0,n)}intersectDraped(e,r,s,a){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],Jt(e,r,this._pp0,this._pp1,void 0,a)}};function rn(t){const e=new ne,{vertex:r,fragment:s,attributes:a,varyings:i}=e,{vvColor:n,hasVertexColors:o}=t;return ei(r,t),e.include(ti,t),e.include(ri,t),e.include(si,t),e.include(ii,t),s.include(ai,t),e.include(ni,t),e.include(oi,t),a.add(p.POSITION,"vec3"),n&&a.add(p.COLORFEATUREATTRIBUTE,"float"),o||i.add("vColor","vec4"),i.add("vpos","vec3",{invariant:!0}),r.uniforms.add(new li("uColor",l=>l.color)),r.main.add(w`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${o?"vColor *= uColor;":n?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),s.include(hi),s.main.add(w`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos, vColor.rgb);`),e}const sn=Object.freeze(Object.defineProperty({__proto__:null,build:rn},Symbol.toStringTag,{value:"Module"}));class an extends se{constructor(e,r){super(e,r,new ie(sn,()=>re(()=>import("./ImageMaterial.glsl-B8OdYn9G.js").then(s=>s.C),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80]))))}_createPipeline(e,r){const{oitPass:s,output:a,transparent:i,cullFace:n,draped:o,hasOccludees:l,polygonOffset:u}=e,d=s===Et.NONE;return ee({blending:Wr(a)&&i?mi(s):null,culling:Fi(n),depthTest:o?null:{func:fi(s)},depthWrite:_i(e),drawBuffers:pi(a,vi(s,a)),colorWrite:te,stencilWrite:l?gi:null,stencilTest:l?r?ui:di:null,polygonOffset:d?u?nn:null:ci(e)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const nn={factor:1,units:1};let F=class extends yi{constructor(){super(...arguments),this.cullFace=Mt.None,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=xi.None,this.emissionSource=bi.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1,this.snowCover=!1}};c([A({count:Mt.COUNT})],F.prototype,"cullFace",void 0),c([A()],F.prototype,"hasVertexColors",void 0),c([A()],F.prototype,"transparent",void 0),c([A()],F.prototype,"discardInvisibleFragments",void 0),c([A()],F.prototype,"polygonOffset",void 0),c([A()],F.prototype,"enableOffset",void 0),c([A()],F.prototype,"writeDepth",void 0),c([A()],F.prototype,"hasOccludees",void 0),c([A()],F.prototype,"terrainDepthTest",void 0),c([A()],F.prototype,"cullAboveTerrain",void 0),c([A()],F.prototype,"objectAndLayerIdColorInstanced",void 0),c([A()],F.prototype,"vvColor",void 0),c([A()],F.prototype,"draped",void 0);class Oo extends tn{constructor(e){super(e,ln),this._configuration=new F,this.supportsEdges=!0,this.produces=new Map([[E.OPAQUE_MATERIAL,r=>this._isOpaqueMaterialPass(r)],[E.OPAQUE_MATERIAL_WITHOUT_NORMALS,r=>this._isOpaqueNoSSAODepthPass(r)],[E.TRANSPARENT_MATERIAL,r=>_t(r)&&this._transparent&&this.parameters.writeDepth],[E.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,r=>er(r)&&this._transparent&&this.parameters.writeDepth],[E.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,r=>_t(r)&&this._transparent&&!this.parameters.writeDepth],[E.DRAPED_MATERIAL,r=>Ai(r)]])}getConfiguration(e,r){return super.getConfiguration(e,r,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=r.hasOccludees,this._configuration.oitPass=r.oitPass,this._configuration.enableOffset=r.camera.relativeElevation<wi,this._configuration.terrainDepthTest=r.terrainDepthTest&&Wr(e),this._configuration.cullAboveTerrain=r.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=Ci}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===R.Highlight||_t(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return er(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new on(e)}createBufferWriter(){const e=ae().vec3f(p.POSITION);return Nr()&&e.vec4u8(p.OLIDCOLOR),this.parameters.vvColor?e.f32(p.COLORFEATUREATTRIBUTE):e.vec4u8(p.COLOR),new Ti(e)}}let on=class extends Ri{beginSlot(e){return this.getTechnique(an,e)}};class ln extends Oi{constructor(){super(...arguments),this.color=Hs,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Mt.None,this.draped=!1,this.discardInvisibleFragments=!1}}var Dr;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Dr||(Dr={}));const $={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},hn={dash:$.dash,"dash-dot":[...$.dash,...$.dot],dot:$.dot,"long-dash":$["long-dash"],"long-dash-dot":[...$["long-dash"],...$.dot],"long-dash-dot-dot":[...$["long-dash"],...$.dot,...$.dot],none:null,"short-dash":$["short-dash"],"short-dash-dot":[...$["short-dash"],...$["short-dot"]],"short-dash-dot-dot":[...$["short-dash"],...$["short-dot"],...$["short-dot"]],"short-dot":$["short-dot"],solid:null},cn=8;function un(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function $o(t){return{pattern:[t,t],pixelRatio:2}}function So(t){return(t==null?void 0:t.type)==="style"?dn(t.style):null}function dn(t){return t!=null?un(hn[t],cn):null}function Do(t,e,r,s){const a=t.type==="polygon"?et.CCW_IS_HOLE:et.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:o}=qr(i,!!t.hasZ,a,t.spatialReference),l=Ir(n.length),u=Hi(n,t.spatialReference,0,l,0,n,0,n.length/3,e,r,s),d=u!=null;return{lines:d?Zr(o,n,l):[],projectionSuccess:d,sampledElevation:u}}function Po(t,e){const r=t.type==="polygon"?et.CCW_IS_HOLE:et.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:a,outlines:i}=qr(s,!1,r),n=Vs(a,t.spatialReference,0,a,e,0);for(let o=2;o<a.length;o+=3)a[o]=en;return{lines:n?Zr(i,a):[],projectionSuccess:n}}function Zr(t,e,r=null){const s=new Array;for(const{index:a,count:i}of t){if(i<=1)continue;const n=3*a,o=3*i;s.push({position:Qt(e,3*a,3*i),mapPositions:r!=null?Qt(r,n,o):void 0})}return s}const Io=ae().vec3f(p.POSITION),Ao=ae().vec3f(p.POSITION).vec2f16(p.UV0),Fo=ae().vec3f(p.POSITION).vec4u8(p.COLOR);ae().vec3f(p.POSITION).vec2f16(p.UV0).vec4u8(p.OLIDCOLOR);const Eo=ae().vec3f(p.POSITION).vec2f(p.UV0),Mo=ae().vec3f(p.POSITION).vec2f(p.UV0).vec4u8(p.OLIDCOLOR);export{Oo as A,fa as B,Bn as C,Kr as D,ar as E,Xa as F,rn as G,nr as I,Io as a,Nn as b,Dr as c,Kn as d,tn as e,Fo as f,wo as g,Mo as h,$o as i,Ao as j,wa as k,Po as l,Ta as m,So as n,Yr as o,Do as p,Br as q,sa as r,en as s,Eo as t,kr as u,xa as v,X as w,rt as x,$a as y,jr as z};
