import{s as h,ag as p,a6 as R,c_ as x}from"./index-Btyj_e22.js";async function $(e,t={},s){await e.load(s);const r=p(e.itemUrl,"resources"),{start:o=1,num:m=10,sortOrder:n="asc",sortField:f="resource"}=t,l={query:{start:o,num:m,sortOrder:n,sortField:f,token:e.apiKey},signal:s==null?void 0:s.signal},a=await e.portal.request(r,l);return{total:a.total,nextStart:a.nextStart,resources:a.resources.map(({created:d,size:c,resource:i})=>({created:new Date(d),size:c,resource:e.resourceFromPath(i)}))}}async function q(e,t,s,r){const o=new Map;for(const{resource:n,content:f,compress:l,access:a}of t){if(!n.hasPath())throw new h(`portal-item-resource-${s}:invalid-path`,"Resource does not have a valid path");const[d,c]=g(n.path),i=`${d}/${l??""}/${a??""}`;o.has(i)||o.set(i,{prefix:d,compress:l,access:a,files:[]}),o.get(i).files.push({fileName:c,content:f})}await e.load(r);const m=p(e.userItemUrl,s==="add"?"addResources":"updateResources");for(const{prefix:n,compress:f,access:l,files:a}of o.values())for(let c=0;c<a.length;c+=25){const i=a.slice(c,c+25),u=new FormData;n&&n!=="."&&u.append("resourcesPrefix",n),f&&u.append("compress","true"),l&&u.append("access",l);let y=0;for(const{fileName:v,content:b}of i)u.append("file"+ ++y,b,v);u.append("f","json"),await e.portal.request(m,{method:"post",body:u,signal:r==null?void 0:r.signal})}}async function F(e,t,s){if(!t.hasPath())throw new h("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const r=p(e.userItemUrl,"removeResources");await e.portal.request(r,{method:"post",query:{resource:t.path},signal:s==null?void 0:s.signal}),t.portalItem=null}async function S(e,t){await e.load(t);const s=p(e.userItemUrl,"removeResources");return e.portal.request(s,{method:"post",query:{deleteAll:!0},signal:t==null?void 0:t.signal})}function g(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function w(e){const[t,s]=P(e),[r,o]=g(t);return[r,o,s]}function P(e){const t=x(e);return t==null?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function O(e){return e.type==="blob"?e.blob:e.type==="json"?new Blob([e.jsonString],{type:"application/json"}):(await R(e.url,{responseType:"blob"})).data}function U(e,t){if(!e.hasPath())return null;const[s,,r]=w(e.path);return e.portalItem.resourceFromPath(p(s,t+r))}function j(e,t){if(!e.hasPath())return null;const[s,,r]=w(e.path);return e.portalItem.resourceFromPath(p(s,t+r))}export{q as addOrUpdateResources,O as contentToBlob,$ as fetchResources,U as getSiblingOfSameType,j as getSiblingOfSameTypeI,S as removeAllResources,F as removeResource,w as splitPrefixFileNameAndExtension};
